"use strict";(self.webpackChunkreact_app=self.webpackChunkreact_app||[]).push([[621],{98082:function(e,t,n){var r=n(29439),a=n(67294),i=n(31808);t.Z=function(){var e=a.useState(!1),t=(0,r.Z)(e,2),n=t[0],c=t[1];return a.useEffect((function(){c((0,i.fk)())}),[]),n}},31808:function(e,t,n){n.d(t,{fk:function(){return c},jD:function(){return i}});var r,a=n(98924),i=function(){return(0,a.Z)()&&window.document.documentElement},c=function(){if(!i())return!1;if(void 0!==r)return r;var e=document.createElement("div");return e.style.display="flex",e.style.flexDirection="column",e.style.rowGap="1px",e.appendChild(document.createElement("div")),e.appendChild(document.createElement("div")),document.body.appendChild(e),r=1===e.scrollHeight,document.body.removeChild(e),r}},19650:function(e,t,n){n.d(t,{u:function(){return v},Z:function(){return h}});var r=n(87462),a=n(4942),i=n(29439),c=n(94184),o=n.n(c),l=n(50344),u=n(67294),s=n(53124),d=n(98082);function p(e){var t=e.className,n=e.direction,i=e.index,c=e.marginDirection,o=e.children,l=e.split,s=e.wrap,d=u.useContext(v),p=d.horizontalSize,m=d.verticalSize,f=d.latestIndex,h={};return d.supportFlexGap||("vertical"===n?i<f&&(h={marginBottom:p/(l?2:1)}):h=(0,r.Z)((0,r.Z)({},i<f&&(0,a.Z)({},c,p/(l?2:1))),s&&{paddingBottom:m})),null==o?null:u.createElement(u.Fragment,null,u.createElement("div",{className:t,style:h},o),i<f&&l&&u.createElement("span",{className:"".concat(t,"-split"),style:h},l))}var m=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},v=u.createContext({latestIndex:0,horizontalSize:0,verticalSize:0,supportFlexGap:!1}),f={small:8,middle:16,large:24};var h=function(e){var t,n=u.useContext(s.E_),c=n.getPrefixCls,h=n.space,g=n.direction,x=e.size,y=void 0===x?(null==h?void 0:h.size)||"small":x,w=e.align,Z=e.className,j=e.children,b=e.direction,C=void 0===b?"horizontal":b,E=e.prefixCls,k=e.split,I=e.style,S=e.wrap,z=void 0!==S&&S,D=m(e,["size","align","className","children","direction","prefixCls","split","style","wrap"]),O=(0,d.Z)(),N=u.useMemo((function(){return(Array.isArray(y)?y:[y,y]).map((function(e){return function(e){return"string"==typeof e?f[e]:e||0}(e)}))}),[y]),R=(0,i.Z)(N,2),B=R[0],L=R[1],U=(0,l.Z)(j,{keepEmpty:!0}),P=void 0===w&&"horizontal"===C?"center":w,M=c("space",E),F=o()(M,"".concat(M,"-").concat(C),(t={},(0,a.Z)(t,"".concat(M,"-rtl"),"rtl"===g),(0,a.Z)(t,"".concat(M,"-align-").concat(P),P),t),Z),G="".concat(M,"-item"),T="rtl"===g?"marginLeft":"marginRight",_=0,A=U.map((function(e,t){null!=e&&(_=t);var n=e&&e.key||"".concat(G,"-").concat(t);return u.createElement(p,{className:G,key:n,direction:C,index:t,marginDirection:T,split:k,wrap:z},e)})),H=u.useMemo((function(){return{horizontalSize:B,verticalSize:L,latestIndex:_,supportFlexGap:O}}),[B,L,_,O]);if(0===U.length)return null;var W={};return z&&(W.flexWrap="wrap",O||(W.marginBottom=-L)),O&&(W.columnGap=B,W.rowGap=L),u.createElement("div",(0,r.Z)({className:F,style:(0,r.Z)((0,r.Z)({},W),I)},D),u.createElement(v.Provider,{value:H},A))}},39227:function(e,t,n){n.r(t),n.d(t,{default:function(){return j}});var r=n(15861),a=n(93433),i=n(29439),c=n(64687),o=n.n(c),l=n(55026),u=n(19650),s=n(71577),d=n(67294),p=function(){function e(){return(e=(0,r.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return e.next=4,e.sent;case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var t=function(){var e=(0,r.Z)(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{getSupportedMimeTypes:function(){var e=["vp9","vp9.0","vp8","vp8.0","avcl","av1","h265","h264"],t=[],n=MediaRecorder.isTypeSupported;return["webm","mp4","mov","avi","wmv","flv","mkv"].forEach((function(r){var a="".concat("video","/").concat(r);e.forEach((function(e){["".concat(a,";codecs=").concat(e),"".concat(a,";codecs=").concat(e.toUpperCase())].forEach((function(e){n(e)&&t.push(e)}))})),n(a)&&t.push(a)})),t},getALlCameraDevices:function(){return e.apply(this,arguments)},getLocalStream:t}},m="src-pages-web-rtc-index-module_kmT-F",v="src-pages-web-rtc-index-module_imFN7",f=n.p+"f85f1a3909344e8bebc4.jpg",h=n(94880),g=n(85893),x="localVideo",y="replay-element",w="canvas-element",Z=null,j=function(){var e=p().getLocalStream,t=(0,d.useState)([]),n=(0,i.Z)(t,2),c=n[0],j=n[1],b=(0,d.useState)(),C=(0,i.Z)(b,2),E=C[0],k=C[1],I=(0,d.useRef)([]);(0,d.useEffect)((function(){var e,t,n;return e=document.getElementById(w),t=e.getContext("2d"),(n=new Image).src=f,n.onload=function(){if(t){t.drawImage(n,0,0,e.width,e.height);var r=t.getImageData(0,0,e.width,e.height);console.log({imgData:r})}},function(){clearInterval(Z),Z=null}}),[]);var S=function(e){document.getElementById(x).srcObject=e},z=function(){var e=(0,r.Z)(o().mark((function e(){var t,n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 1024,1048576,t={mimeType:"video/webm"},e.next=5,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 5:n=e.sent,r=new MediaRecorder(n,t),k(r),r.start(0),r.ondataavailable=function(e){I.current.push(e.data)},r.onstop=function(){console.log("stop recording..")},r.onerror=function(e){console.log("recording eroror..",{e:e})};case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=(0,r.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0});case 2:t=e.sent,S(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,g.jsxs)("div",{children:[(0,g.jsx)("h1",{children:"this is webRTC"}),(0,g.jsx)("div",{children:(0,g.jsxs)(u.Z,{wrap:!0,children:[(0,g.jsx)(s.Z,{onClick:function(){e({audio:!1,video:!0}).then((function(e){S(e)}))},children:"开启摄像头"}),(0,g.jsx)(s.Z,{onClick:D,children:"开启屏幕共享"}),(0,g.jsx)(s.Z,{onClick:function(){var e=document.getElementById(x),t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;var n=t.getContext("2d");null==n||n.drawImage(e,0,0,t.width,t.height);var r=t.toDataURL("image/png");j((function(e){return[].concat((0,a.Z)(e),[{id:(0,h.Ki)(),url:r}])}))},children:"拍照"}),(0,g.jsx)(s.Z,{onClick:z,children:"开始录制"}),(0,g.jsx)(s.Z,{onClick:function(){if(!E)return l.ZP.error("未录制");E.stop(),k(void 0)},children:"结束录制"}),(0,g.jsx)(s.Z,{onClick:function(){var e=new Blob(I.current,{type:"video/webm"}),t=URL.createObjectURL(e),n=document.getElementById(y);n.src=t,n.play()},children:"回放"}),(0,g.jsx)(s.Z,{onClick:function(){if(I.current.length){var e=new Blob(I.current,{type:"video/webm"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=t,n.click(),URL.revokeObjectURL(t),I.current=[]}},children:"下载"}),(0,g.jsx)(s.Z,{onClick:function(){var e=document.getElementById(w),t=document.getElementById(x),n=e.getContext("2d");n&&n.drawImage(t,0,0,e.width,e.height)},children:"将视频绘制到canvas中"})]})}),(0,g.jsx)("div",{children:(0,g.jsxs)(u.Z,{wrap:!0,children:[(0,g.jsx)("canvas",{id:w,className:v}),(0,g.jsx)("video",{id:x,autoPlay:!0,playsInline:!0,muted:!0,className:v}),(0,g.jsx)("video",{id:"combination-element",autoPlay:!0,playsInline:!0,muted:!0,className:v})]})}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{children:"回放"}),(0,g.jsx)("video",{id:y,autoPlay:!0,playsInline:!0,muted:!0})]}),(0,g.jsx)("div",{children:(0,g.jsx)(u.Z,{children:c.map((function(e){return(0,g.jsx)("img",{src:e.url,className:m},e.id)}))})})]})}}}]);